<!DOCTYPE html>
<html lang="en">
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title><?= homeTeam ?> vs <?= gameInfo.opponent || 'Opponent' ?></title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;600;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">

  <style>
    :root {
      --brand: #b71c1c;
      --brand-dark: #7f0000;
      --bg: #0d1117;
      --panel: #161b22;
      --panel-soft: #1f2933;
      --text: #f5f5f5;
      --muted: #9ca3af;
      --accent: #facc15;
      --card-hover: rgba(248, 250, 252, 0.1);
      --border-subtle: rgba(148, 163, 184, 0.35);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Poppins', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      font-size: 16px; /* bumped for readability */
      background: radial-gradient(circle at top, #1f2937 0, #020617 55%, #000000 100%);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      padding: 16px;
      -webkit-font-smoothing: antialiased;
    }

    main.page {
      width: 100%;
      max-width: 1100px;
      margin: 0 auto;
      border-radius: 18px;
      background: linear-gradient(135deg, rgba(248, 250, 252, 0.04), rgba(15, 23, 42, 0.9));
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.6);
      padding: 20px 18px 22px;
      position: relative;
      overflow: hidden;
    }

    .page::before {
      content: "";
      position: absolute;
      inset: 0;
      background-image: radial-gradient(circle at 1px 1px, rgba(148, 163, 184, 0.2) 1px, transparent 0);
      background-size: 38px 38px;
      opacity: 0.12;
      pointer-events: none;
    }

    /* LEAGUE LOGO TOP */
    .league-logo-top {
      width: 100%;
      text-align: center;
      margin-bottom: 10px;
      padding-top: 4px;
    }

    .league-logo-top img {
      max-height: 72px;
      max-width: 260px;
      object-fit: contain;
    }

    /* ===== HEADER / HERO ===== */

    header.hero {
      position: relative;
      z-index: 1;
      padding: 8px 4px 16px;
      border-bottom: 1px solid var(--border-subtle);
      margin-bottom: 16px;
      display: grid;
      grid-template-columns: minmax(0, 2fr) minmax(0, 1.4fr);
      gap: 12px;
      align-items: center;
      justify-items: start;
    }

    .matchup {
      display: flex;
      flex-wrap: wrap;
      align-items: baseline;
      gap: 8px;
    }

    .matchup-main {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 10px;
    }

    .home-block {
      display: inline-flex;
      align-items: center;
      gap: 10px;
    }

    .logo-wrap {
      width: 52px;
      height: 52px;
      border-radius: 999px;
      background: radial-gradient(circle at top, rgba(252, 211, 77, 0.24), rgba(15, 23, 42, 1));
      border: 2px solid var(--accent);
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      box-shadow: 0 8px 18px rgba(234, 179, 8, 0.4);
    }

    .logo-wrap img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .logo-placeholder {
      font-family: 'Oswald', sans-serif;
      font-size: 0.9rem;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: #fefce8;
      text-align: center;
    }

    .team-name {
      font-family: 'Oswald', sans-serif;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      font-size: clamp(1.3rem, 2.1vw, 1.5rem);
      color: #e5e7eb;
      font-weight: 600;
    }

    .vs-badge {
      font-family: 'Oswald', sans-serif;
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(248, 250, 252, 0.5);
      color: var(--accent);
      background: rgba(15, 23, 42, 0.6);
    }

    .opponent-name {
      font-family: 'Oswald', sans-serif;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      font-size: clamp(1.5rem, 2.6vw, 2.1rem);
      color: #fefce8;
      padding: 4px 14px;
      border-radius: 999px;
      background: linear-gradient(135deg, var(--brand), var(--brand-dark));
      box-shadow: 0 8px 18px rgba(185, 28, 28, 0.7);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      font-weight: 600;
    }

    .subline {
      margin-top: 4px;
      font-size: 0.97rem;
      color: #e5e7eb;
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }

    .subline span {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .pill {
      font-size: 0.82rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      color: rgba(229, 231, 235, 0.98);
      background: rgba(15, 23, 42, 0.7);
      font-weight: 500;
    }

    .info-box {
      justify-self: end;
      text-align: right;
      font-size: 0.97rem;
    }

    .info-label {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.22em;
      color: var(--muted);
      margin-bottom: 4px;
    }

    .info-main {
      font-family: 'Oswald', sans-serif;
      font-size: 1.28rem;
      letter-spacing: 0.26em;
      text-transform: uppercase;
      color: #f9fafb;
      font-weight: 600;
    }

    .info-secondary {
      color: #e5e7eb;
      font-size: 0.86rem;
      margin-top: 4px;
    }

    /* === MAIN LAYOUT (GRID AREAS) === */

    .main-grid {
      position: relative;
      z-index: 1;
      display: grid;
      grid-template-columns: minmax(0, 3.3fr) minmax(0, 2.2fr);
      grid-template-areas:
        "rangers sponsors"
        "opponent opponent";
      gap: 16px;
    }

    /* Rangers column: roster + card side-by-side */
    .rangers-section {
      grid-area: rangers;
      display: grid;
      grid-template-columns: minmax(0, 1.6fr) minmax(0, 1.4fr);
      gap: 16px;
    }

    .panel {
      background: radial-gradient(circle at top left, rgba(148, 163, 184, 0.16), rgba(15, 23, 42, 0.95));
      border-radius: 16px;
      padding: 12px 10px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      box-shadow: 0 10px 22px rgba(15, 23, 42, 0.9);
      backdrop-filter: blur(12px);
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 8px;
      padding: 0 2px;
    }

    .panel-title {
      font-family: 'Oswald', sans-serif;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      font-size: 0.96rem;
      color: #e5e7eb;
      font-weight: 600;
    }

    .panel-title span {
      color: #ffffff;
    }

    .panel-subtitle {
      font-size: 0.9rem;
      color: #f3f4f6;
      font-weight: 400;
    }

    .panel-subtitle--hint {
      position: relative;
    }

    .panel-subtitle--hint::before {
      content: "‚¨Ö";
      margin-right: 4px;
      opacity: 0.9;
    }

    .roster-grid {
      display: flex;
      flex-direction: column;
      gap: 4px;
      max-height: 360px;
      overflow-y: auto;
      padding-right: 4px;
      margin-top: 4px;
      -webkit-overflow-scrolling: touch;
      scroll-behavior: smooth;
    }

    /* ===== ROSTER ROWS (BOTH TEAMS) ===== */
    .player-row,
    .opp-row {
      display: grid;
      grid-template-columns: 52px minmax(0, 2.2fr) 0.7fr;
      align-items: center;
      gap: 6px;
      padding: 11px 13px;
      border-radius: 10px;
      border: 1px solid transparent;
      font-size: 1.12rem; /* slightly larger */
    }

    .player-row {
      cursor: pointer;
      transition: background 0.15s ease, transform 0.08s ease, border 0.15s ease;
    }

    .player-row:hover {
      background: var(--card-hover);
      border-color: rgba(248, 250, 252, 0.3);
      transform: translateY(-1px);
    }

    .player-row.active {
      background: rgba(234, 179, 8, 0.18);
      border-color: #facc15;
      box-shadow: 0 0 0 2px rgba(234, 179, 8, 0.5);
    }

    .opp-row {
      background: rgba(15, 23, 42, 0.85);
      border-color: rgba(148, 163, 184, 0.35);
    }

    .cell-num {
      font-family: 'Oswald', sans-serif;
      font-size: 1.35rem;
      text-align: center;
      color: var(--accent);
      font-weight: 800;
    }

    .cell-name {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      color: #ffffff;
      font-weight: 800;
      font-size: 1.28rem;
      letter-spacing: 0.02em;
    }

    .cell-pos {
      font-size: 1rem;
      text-transform: uppercase;
      letter-spacing: 0.09em;
      justify-self: end;
      color: #e5e7eb;
      font-weight: 700;
    }

    /* Zebra striping for readability */
    .roster-grid .player-row:nth-child(odd),
    .roster-grid .opp-row:nth-child(odd) {
      background: rgba(15, 23, 42, 0.92);
    }

    .roster-grid .player-row:nth-child(even),
    .roster-grid .opp-row:nth-child(even) {
      background: rgba(15, 23, 42, 0.78);
    }

    .photo-panel {
      display: flex;
      flex-direction: column;
      align-items: stretch;
      justify-content: flex-start;
      gap: 12px;
    }

    .photo-card {
      background: radial-gradient(circle at top, rgba(248, 250, 252, 0.07), rgba(15, 23, 42, 0.95));
      border-radius: 16px;
      padding: 12px;
      border: 1px solid rgba(148, 163, 184, 0.45);
      text-align: center;
      box-shadow: 0 12px 28px rgba(15, 23, 42, 0.9);
    }

    .photo-label {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--muted);
      margin-bottom: 4px;
    }

    .photo-name {
      font-family: 'Oswald', sans-serif;
      font-size: 1.32rem;
      letter-spacing: 0.06em;
      margin-bottom: 6px;
      font-weight: 600;
    }

    .photo-meta {
      font-size: 0.94rem;
      color: #e5e7eb;
      margin-bottom: 10px;
    }

    .photo-frame {
      border-radius: 14px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      padding: 4px;
      background: radial-gradient(circle at top, rgba(248, 250, 252, 0.07), rgba(15, 23, 42, 1));
      min-height: 210px;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .photo-frame img {
      max-width: 100%;
      max-height: 260px;
      border-radius: 10px;
      object-fit: cover;
      display: none;
      cursor: pointer;
    }

    .photo-placeholder {
      font-size: 0.96rem;
      color: var(--muted);
      padding: 0 12px;
    }

    /* STATS CARD UNDER PLAYER PHOTO */
    .stats-card {
      background: radial-gradient(circle at top, rgba(148, 163, 184, 0.14), rgba(15, 23, 42, 0.98));
      border-radius: 16px;
      padding: 11px 14px 12px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      box-shadow: 0 10px 22px rgba(15, 23, 42, 0.9);
      font-size: 0.92rem;
    }

    .stats-label {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--muted);
      margin-bottom: 4px;
    }

    .stats-meta {
      font-size: 0.9rem;
      color: #e5e7eb;
      margin-bottom: 8px;
      font-style: italic;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: minmax(0, 1.3fr) minmax(0, 1fr);
      row-gap: 5px;
      column-gap: 12px;
    }

    .stats-row {
      display: contents;
    }

    .stats-label-cell {
      text-transform: uppercase;
      letter-spacing: 0.1em;
      font-size: 0.95rem;
      color: #e5e7eb;
      font-weight: 700;
    }

    .stats-value-cell {
      text-align: right;
      font-weight: 800;
      color: #ffffff;
      font-size: 1.08rem;
    }

    .footer-note {
      font-size: 0.78rem;
      color: var(--muted);
      opacity: 0.8;
      text-align: center;
      margin-top: 4px;
    }

    .roster-hint {
      text-align: left;
      margin-top: 6px;
    }

    /* ===== NEXT HOME GAME (pops a bit more) ===== */
    .next-game-card {
      margin-top: 12px;
      background: radial-gradient(circle at top, rgba(148, 163, 184, 0.16), rgba(15, 23, 42, 0.98));
      border-radius: 16px;
      padding: 14px 16px;
      border: 1px solid rgba(250, 204, 21, 0.8);
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.9);
      display: grid;
      grid-template-columns: auto minmax(0, 1fr);
      gap: 12px;
      align-items: center;
      font-size: 0.9rem;
    }

    .next-game-label {
      font-family: 'Oswald', sans-serif;
      font-size: 0.92rem;
      text-transform: uppercase;
      letter-spacing: 0.22em;
      color: #fefce8;
      margin-bottom: 4px;
    }

    .next-game-opponent {
      font-family: 'Oswald', sans-serif;
      font-size: 1.3rem;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      color: #ffffff;
      font-weight: 700;
    }

    .next-game-details {
      font-size: 0.94rem;
      color: #e5e7eb;
      margin-top: 5px;
      line-height: 1.35;
    }

    .next-game-logo-wrap {
      width: 58px;
      height: 58px;
      border-radius: 999px;
      border: 2px solid rgba(250, 204, 21, 0.85);
      background: radial-gradient(circle at top, rgba(250, 204, 21, 0.24), rgba(15, 23, 42, 1));
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .next-game-logo {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }

    .next-game-logo-placeholder {
      font-size: 0.82rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: #fef9c3;
      text-align: center;
      padding: 4px;
    }

    /* Opponent panel area */
    .panel-opp {
      grid-area: opponent;
    }

    /* === SPONSORS === */
    .sponsors-section {
      grid-area: sponsors;
      position: relative;
      z-index: 1;
    }

    .sponsors-panel {
      margin-top: 6px;
    }

    .sponsors-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 8px;
    }

    .sponsors-title {
      font-family: 'Oswald', sans-serif;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      font-size: 0.9rem;
      color: var(--muted);
      font-weight: 500;
    }

    .sponsors-title span {
      color: #f9fafb;
    }

    .sponsors-subtitle {
      font-size: 0.84rem;
      color: #e5e7eb;
    }

    .sponsor-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
    }

    .sponsor-card {
      width: 150px;
      max-width: 40vw;
      padding: 8px 8px 10px;
      border-radius: 12px;
      background: radial-gradient(circle at top, rgba(248, 250, 252, 0.06), rgba(15, 23, 42, 1));
      border: 1px solid rgba(148, 163, 184, 0.4);
      text-align: center;
      box-shadow: 0 6px 16px rgba(15, 23, 42, 0.8);
      text-decoration: none;
      color: inherit;
      transition: transform 0.12s ease, box-shadow 0.12s ease, border 0.12s ease;
      font-size: 0.86rem;
    }

    .sponsor-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 22px rgba(15, 23, 42, 0.95);
      border-color: rgba(250, 204, 21, 0.7);
    }

    .sponsor-logo-wrap {
      height: 68px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 6px;
    }

    .sponsor-logo {
      max-width: 100%;
      max-height: 68px;
      object-fit: contain;
    }

    .sponsor-name {
      font-size: 0.95rem;
      font-weight: 600;
      color: #e5e7eb;
    }

    .sponsor-tag {
      font-size: 0.76rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--muted);
      margin-top: 2px;
    }

    /* Main sponsor (bigger logo, centered) */
    .main-sponsor-card-wrap {
      margin-bottom: 10px;
    }

    .main-sponsor-card {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      gap: 10px;
      padding: 16px 18px;
      border-radius: 14px;
      border: 1px solid rgba(250, 204, 21, 0.8);
      background: radial-gradient(circle at top, rgba(250, 204, 21, 0.14), rgba(15, 23, 42, 1));
      box-shadow: 0 10px 26px rgba(15, 23, 42, 0.95);
      text-decoration: none;
      color: inherit;
    }

    .main-sponsor-logo-wrap {
      width: 260px;
      max-width: 85vw;
      height: 140px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(15, 23, 42, 0.8);
      border-radius: 12px;
      padding: 10px;
    }

    .main-sponsor-logo {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }

    .main-sponsor-text {
      flex: 0 0 auto;
      min-width: 0;
    }

    .main-sponsor-name {
      font-size: 1.25rem;
      font-weight: 600;
      color: #fefce8;
    }

    .main-sponsor-tagline {
      font-size: 0.9rem;
      color: #e5e7eb;
      margin-top: 4px;
    }

    .main-sponsor-badge {
      font-size: 0.76rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(250, 204, 21, 0.9);
      color: #facc15;
      white-space: nowrap;
      margin-top: 2px;
    }

    /* Full-screen overlay for photo */
    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.9);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 10px;
      z-index: 9999;
    }

    .overlay img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }

    .overlay-close-hint {
      position: absolute;
      bottom: 16px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 0.8rem;
      color: #e5e7eb;
      opacity: 0.8;
    }

    /* ===== MOBILE / TABLET LAYOUT ===== */
    @media (max-width: 1200px) {

      body {
        padding: 8px;
        font-size: 17px; /* global bump */
      }

      main.page {
        padding: 12px;
        border-radius: 14px;
        box-shadow: 0 12px 26px rgba(0, 0, 0, 0.45);
      }

      .league-logo-top img {
        max-height: 72px;
        max-width: 260px;
      }

      header.hero {
        grid-template-columns: 1fr;
        justify-items: center;    /* center entire header content */
        text-align: center;
      }

      .matchup {
        justify-content: center;  /* center team vs row */
        width: 100%;
      }

      .matchup-main {
        justify-content: center;
      }

      .info-box {
        justify-self: center;
        text-align: center;
        margin-top: 10px;
        font-size: 1.05rem;
      }

      .team-name {
        font-size: 1.6rem;
      }

      .opponent-name {
        font-size: 2.0rem;
        padding-inline: 18px;
        box-shadow: 0 6px 14px rgba(185, 28, 28, 0.55); /* slightly softer on mobile */
      }

      .subline {
        justify-content: center;
        text-align: center;
        margin-top: 8px;
        font-size: 1rem;
      }

      .info-label {
        letter-spacing: 0.24em;
      }

      .main-grid {
        grid-template-columns: 1fr;
        grid-template-areas:
          "rangers"
          "sponsors"
          "opponent";
      }

      .rangers-section {
        grid-template-columns: minmax(0, 1.45fr) minmax(0, 1.2fr);
        gap: 14px;
      }

      .roster-grid {
        max-height: 52vh;
      }

      /* Bigger roster rows on mobile + extra breathing room */
      .player-row,
      .opp-row {
        padding: 13px 16px;
        grid-template-columns: 60px minmax(0, 2.4fr) 0.6fr;
        font-size: 1.26rem;
        margin-bottom: 4px;
      }

      .cell-num {
        font-size: 1.45rem;
      }

      .cell-pos {
        font-size: 1.05rem;
      }

      .photo-name {
        font-size: 1.8rem;
      }

      .photo-meta {
        font-size: 1.18rem;
      }

      .photo-placeholder {
        font-size: 1.12rem;
      }

      .stats-label-cell {
        font-size: 0.94rem;
      }

      .stats-value-cell {
        font-size: 1.12rem;
      }

      /* Make hints / subtitles more readable on mobile */
      .panel-subtitle {
        font-size: 1rem;
        font-weight: 500;
      }

      /* Slightly lighter shadows on mobile for smoother scrolling */
      .panel,
      .photo-card,
      .stats-card,
      .main-sponsor-card,
      .sponsor-card {
        box-shadow: 0 6px 16px rgba(15, 23, 42, 0.7);
      }

      .sponsors-header {
        flex-direction: column;
        align-items: center;
        gap: 4px;
        text-align: center;
      }

      .sponsors-title {
        font-size: 1rem;
      }

      .sponsors-subtitle {
        font-size: 0.97rem;
      }

      .main-sponsor-name {
        font-size: 1.45rem;
      }

      .main-sponsor-tagline {
        font-size: 1.06rem;
      }

      .sponsor-card {
        width: 46vw;
        font-size: 0.98rem;
      }

      .sponsor-name {
        font-size: 1.06rem;
      }

      .sponsor-tag {
        font-size: 0.9rem;
      }

      .main-sponsor-logo-wrap {
        width: 90vw;
        height: 170px;
      }

      .main-sponsor-badge {
        margin-top: 4px;
      }

      .panel-opp {
        margin-top: 6px;
      }

      .panel-title {
        font-size: 1rem;
      }

      .panel-subtitle {
        font-size: 1rem;
      }
    }

  </style>
</head>
<body>
  <main class="page" role="main">
    <!-- League logo at the very top -->
    <? if (leagueLogo) { ?>
      <div class="league-logo-top">
        <img src="<?= leagueLogo ?>" alt="League Logo">
      </div>
    <? } ?>

    <header class="hero">
      <div>
        <div class="matchup">
          <div class="matchup-main">
            <!-- Home side -->
            <div class="home-block">
              <div class="logo-wrap">
                <? if (homeLogo) { ?>
                  <img src="<?= homeLogo ?>" alt="<?= homeTeam ?> logo">
                <? } else {
                  var initials = (homeTeam || '')
                    .split(' ')
                    .filter(function(w){ return w && w[0]; })
                    .map(function(w){ return w[0]; })
                    .join('')
                    .substring(0,3)
                    .toUpperCase();
                ?>
                  <div class="logo-placeholder"><?= initials || 'RNG' ?></div>
                <? } ?>
              </div>
              <div class="team-name"><?= homeTeam ?></div>
            </div>

            <div class="vs-badge">vs</div>

            <!-- Opponent side (NAME first, LOGO on far right) -->
            <div class="home-block">
              <div class="opponent-name"><?= gameInfo.opponent || 'TBA' ?></div>
              <div class="logo-wrap">
                <? if (typeof opponentLogo !== 'undefined' && opponentLogo) { ?>
                  <img src="<?= opponentLogo ?>" alt="<?= gameInfo.opponent || 'Opponent' ?> logo">
                <? } else {
                  var oppInitials = (gameInfo.opponent || 'OPP')
                    .split(' ')
                    .filter(function(w){ return w && w[0]; })
                    .map(function(w){ return w[0]; })
                    .join('')
                    .substring(0,3)
                    .toUpperCase();
                ?>
                  <div class="logo-placeholder"><?= oppInitials || 'OPP' ?></div>
                <? } ?>
              </div>
            </div>
          </div>
        </div>

        <div class="subline">
          <span class="pill"><?= gameInfo.arena || 'Arena TBA' ?></span>
          <span>üóì <?= gameInfo.date || 'Date TBA' ?></span>
          <span>‚è∞ <?= gameInfo.time || 'Time TBA' ?></span>
        </div>
      </div>

      <div class="info-box">
        <div class="info-label">Game Day Program</div>
        <div class="info-main">Scan ‚Ä¢ Read ‚Ä¢ Cheer</div>
        <div class="info-secondary">
          <span>Tap a Rangers player to view their photo and season stats.</span>
        </div>
      </div>
    </header>

    <section class="main-grid">
      <!-- Rangers column: roster + card -->
      <section class="rangers-section">
        <!-- Rangers roster -->
        <section class="panel panel-home">
          <div class="panel-header">
            <div class="panel-title"><span>Rangers Roster</span></div>
            <div class="panel-subtitle panel-subtitle--hint">Tap a player to show their card ‚Üí</div>
          </div>

          <div class="roster-grid" id="home-roster">
            <? roster.forEach(function(p, idx) { ?>
              <div
                class="player-row"
                data-index="<?= idx ?>"
                role="button"
                tabindex="0"
                aria-label="View stats and photo for <?= p.name ?>">
                <div class="cell-num">#<?= p.number ?></div>
                <div class="cell-name"><?= p.name ?></div>
                <div class="cell-pos"><?= p.position ?></div>
              </div>
            <? }); ?>
            <? if (!roster.length) { ?>
              <div class="panel-subtitle">No roster data found. Check the "Roster" sheet.</div>
            <? } ?>
          </div>

          <div class="footer-note roster-hint">Scroll to see full roster.</div>
        </section>

        <!-- Player photo + stats panel -->
        <aside class="photo-panel" aria-label="Rangers player details">
          <div class="photo-card">
            <div class="photo-label">Rangers Player Card</div>
            <div class="photo-name" id="player-name">Tap a player on the left</div>
            <div class="photo-meta" id="player-meta">Jersey ‚Ä¢ Position</div>

            <div class="photo-frame">
              <img id="player-photo" alt="Player photo">
              <div class="photo-placeholder" id="photo-placeholder">
                When you tap a player, their photo will appear here.
              </div>
            </div>
          </div>

          <div class="stats-card">
            <div class="stats-label">Season Stats</div>
            <div class="stats-meta" id="stats-meta">Tap a player to view their stats.</div>
            <div class="stats-grid" id="stats-grid" aria-live="polite">
              <!-- Filled dynamically -->
            </div>
          </div>

          <!-- NEXT HOME GAME CARD -->
          <? if (typeof nextGame !== 'undefined' && nextGame && nextGame.opponent) { ?>
            <div class="next-game-card">
              <div class="next-game-logo-wrap">
                <? if (nextGame.logo) { ?>
                  <img src="<?= nextGame.logo ?>" alt="<?= nextGame.opponent ?> logo" class="next-game-logo">
                <? } else { ?>
                  <div class="next-game-logo-placeholder">
                    NEXT<br>GAME
                  </div>
                <? } ?>
              </div>
              <div>
                <div class="next-game-label">Next Home Game</div>
                <div class="next-game-opponent"><?= nextGame.opponent ?></div>
                <div class="next-game-details">
                  <? if (nextGame.date) { ?>üóì <?= nextGame.date ?><br><? } ?>
                  <? if (nextGame.time) { ?>‚è∞ <?= nextGame.time ?><? } ?>
                  <? if (nextGame.arena) { ?><br>üìç <?= nextGame.arena ?><? } ?>
                </div>
              </div>
            </div>
          <? } ?>

          <div class="footer-note">
            Data powered by Google Sheets ‚Ä¢ Program generated for fans, players, and families.
          </div>
        </aside>
      </section>

      <!-- Sponsors (right of Rangers; under card on mobile) -->
      <section class="sponsors-section">
        <div class="sponsors-header">
          <div class="sponsors-title"><span>Thank You to Our Sponsors</span></div>
          <div class="sponsors-subtitle">Proud supporters of the Rangers</div>
        </div>

        <section class="panel sponsors-panel">
          <? if (sponsors && sponsors.length) { 
               var main = sponsors[0];
               var rest = sponsors.slice(1);
               var mainHasLogo = !!main.logo;
               var mainHasLink = !!main.website;
          ?>
            <!-- Main / Presenting Sponsor -->
            <div class="main-sponsor-card-wrap">
              <? if (mainHasLink) { ?>
                <a class="main-sponsor-card" href="<?= main.website ?>" target="_blank" rel="noopener">
              <? } else { ?>
                <div class="main-sponsor-card">
              <? } ?>
                  <div class="main-sponsor-logo-wrap">
                    <? if (mainHasLogo) { ?>
                      <img src="<?= main.logo ?>" alt="<?= main.name ?> logo" class="main-sponsor-logo">
                    <? } else { ?>
                      <span class="main-sponsor-name"><?= main.name ?></span>
                    <? } ?>
                  </div>
                  <div class="main-sponsor-text">
                    <? if (mainHasLogo) { ?>
                      <div class="main-sponsor-name"><?= main.name ?></div>
                    <? } ?>
                    <div class="main-sponsor-tagline">Presenting Sponsor of tonight&#39;s game</div>
                  </div>
                  <div class="main-sponsor-badge">Main Sponsor</div>
              <? if (mainHasLink) { ?>
                </a>
              <? } else { ?>
                </div>
              <? } ?>
            </div>

            <!-- Remaining sponsors -->
            <? if (rest && rest.length) { ?>
              <div class="sponsor-grid">
                <? rest.forEach(function(s) { 
                     var hasLogo = !!s.logo;
                     var hasLink = !!s.website;
                ?>
                  <? if (hasLink) { ?>
                    <a class="sponsor-card" href="<?= s.website ?>" target="_blank" rel="noopener">
                  <? } else { ?>
                    <div class="sponsor-card">
                  <? } ?>
                      <div class="sponsor-logo-wrap">
                        <? if (hasLogo) { ?>
                          <img src="<?= s.logo ?>" alt="<?= s.name ?> logo" class="sponsor-logo">
                        <? } else { ?>
                          <div class="sponsor-name"><?= s.name ?></div>
                        <? } ?>
                      </div>
                      <? if (hasLogo) { ?>
                        <div class="sponsor-name"><?= s.name ?></div>
                      <? } ?>
                      <div class="sponsor-tag">Rangers Sponsor</div>
                  <? if (hasLink) { ?>
                    </a>
                  <? } else { ?>
                    </div>
                  <? } ?>
                <? }); ?>
              </div>
            <? } ?>
          <? } else { ?>
            <div class="panel-subtitle">
              Sponsor logos will appear here when you add them to the "Sponsors" sheet.
            </div>
          <? } ?>
        </section>
      </section>

      <!-- Opponent roster (full width below) -->
      <section class="panel panel-opp">
        <div class="panel-header">
          <div class="panel-title">
            <span><?= gameInfo.opponent || 'Opponent' ?></span> Roster
          </div>
          <div class="panel-subtitle">Listed by jersey number</div>
        </div>

        <div class="roster-grid">
          <? opponentRoster.forEach(function(p) { ?>
            <div class="opp-row">
              <div class="cell-num">#<?= p.number ?></div>
              <div class="cell-name"><?= p.name ?></div>
              <div class="cell-pos"><?= p.position ?></div>
            </div>
          <? }); ?>
          <? if (!opponentRoster.length) { ?>
            <div class="panel-subtitle">No opponent roster found. Check the "Opponent" sheet.</div>
          <? } ?>
        </div>
      </section>
    </section>
  </main>

  <!-- Full-screen overlay for photo -->
  <div id="overlay" class="overlay">
    <img id="overlay-img" alt="Player photo enlarged">
    <div class="overlay-close-hint">Tap anywhere to close</div>
  </div>

  <script>
    const ROSTER_DATA = <?!= JSON.stringify(roster) ?>;
    const STAT_FIELDS = ['GP', 'Goals', 'Assists', 'Points', 'PIM']; // what we display

    document.addEventListener('DOMContentLoaded', function () {
      const rows             = document.querySelectorAll('.player-row');
      const photoImg         = document.getElementById('player-photo');
      const photoPlaceholder = document.getElementById('photo-placeholder');
      const playerNameEl     = document.getElementById('player-name');
      const playerMetaEl     = document.getElementById('player-meta');
      const overlay          = document.getElementById('overlay');
      const overlayImg       = document.getElementById('overlay-img');

      const statsMetaEl      = document.getElementById('stats-meta');
      const statsGridEl      = document.getElementById('stats-grid');

      function clearStats(message) {
        statsMetaEl.textContent = message || 'Tap a player to view their stats.';
        statsGridEl.innerHTML = '';
      }

      rows.forEach(function (row) {
        row.addEventListener('click', function () {
          const index  = parseInt(this.dataset.index, 10);
          const player = ROSTER_DATA[index];
          if (!player) return;

          // Highlight selection
          rows.forEach(r => r.classList.remove('active'));
          this.classList.add('active');

          // Update player card text
          playerNameEl.textContent = player.name || 'Unknown player';
          const num = player.number ? '#' + player.number : '';
          const pos = player.position || '';
          playerMetaEl.textContent = [num, pos].filter(Boolean).join(' ‚Ä¢ ') || 'Rangers';

          // Update photo
          if (player.photo) {
            photoImg.src = player.photo;
            photoImg.style.display = 'block';
            photoPlaceholder.style.display = 'none';
          } else {
            photoImg.src = '';
            photoImg.style.display = 'none';
            photoPlaceholder.style.display = 'block';
            photoPlaceholder.textContent = 'No photo available.';
          }

          // Update stats
          const jerseyNumber = player.number;
          if (!jerseyNumber && jerseyNumber !== 0) {
            clearStats('No jersey number for this player.');
            return;
          }

          clearStats('Loading stats...');

          if (typeof google !== 'undefined' && google.script && google.script.run) {
            google.script.run
              .withSuccessHandler(function(stats) {
                if (!stats) {
                  clearStats('No stats found for #' + jerseyNumber + '.');
                  return;
                }

                statsMetaEl.textContent = 'Season to date';
                statsGridEl.innerHTML = '';

                const frag = document.createDocumentFragment();

                STAT_FIELDS.forEach(function(field) {
                  if (!(field in stats)) return;

                  const rowDiv = document.createElement('div');
                  rowDiv.className = 'stats-row';

                  const labelDiv = document.createElement('div');
                  labelDiv.className = 'stats-label-cell';
                  labelDiv.textContent = field;

                  const valueDiv = document.createElement('div');
                  valueDiv.className = 'stats-value-cell';

                  let val = stats[field];
                  if (val === '' || val === null || typeof val === 'undefined') {
                    val = '‚Äî';
                  }

                  valueDiv.textContent = val;

                  rowDiv.appendChild(labelDiv);
                  rowDiv.appendChild(valueDiv);
                  frag.appendChild(rowDiv);
                });

                statsGridEl.appendChild(frag);
              })
              .withFailureHandler(function(err) {
                clearStats('Error loading stats.');
              })
              .api_getStatsForPlayer(jerseyNumber);
          } else {
            // If google.script.run is not available (e.g., local preview)
            clearStats('Stats unavailable in this preview.');
          }
        });

        // Keyboard accessibility (Enter / Space)
        row.addEventListener('keydown', function (e) {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            this.click();
          }
        });
      });

      // Full-screen overlay on photo click
      photoImg.addEventListener('click', function () {
        if (!photoImg.src) return;
        overlayImg.src = photoImg.src;
        overlay.style.display = 'flex';
      });

      overlay.addEventListener('click', function () {
        overlay.style.display = 'none';
      });
    });
  </script>
</body>
</html>
